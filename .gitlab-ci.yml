# stages:
#   - build
#   - test

# job_build:
#   stage: build
#   before_script:
#     - echo 'build starts'
#     - chmod +x ./hospital_here/hospital_here/gradlew
#   script:
#     - ./hospital_here/hospital_here/gradlew clean build
#   artifacts:
#     paths:
#       - ./hospital_here/hospital_here/build/libs/*.jar

# job_test:
#   stage: test
#   script:
#     - echo "Running tests"

stages:
  - build
  - deploy

spring_build:
  stage: 
    build
  only:
    - dev
  before_script:
    - cd ~/builds/PBnDJ9Bm/0/cloud_track/class_03/web_project3/team05/hospital_here_spring/hospital_here/hospital_here
    - sudo chmod +x gradlew
    - echo "import org.gradle.api.tasks.compile.JavaCompile" >> build.gradlew.kts
    - echo 'tasks.withType<JavaCompile> {options.compilerArgs.add("-Xlint:-unchecked")}' >> build.gradle.kts
  script:
    - ./gradlew clean build
  after_script:
    - echo 'build success..'

spring_deploy:
  stage: 
    deploy
  only:
    - dev
  before_script:
    - sudo ~/builds/kill_spring.sh
  script:
    - nohup java -jar build/libs/hospital_here-0.0.1.jar &
  after_script:
    - echo 'deploy success..'